---
title: "DS 6372 Project 1"
output: html_document
---
# World Health Organization

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
library(ggplot2)
library(plyr)
library(dplyr)
library(GGally)
library(tidyverse)
library(naniar)
library(zoom)
library(MASS)
library(ggpubr)
library(onewaytests)

```

## Context

---


Although there have been lot of studies undertaken in the past on factors affecting life expectancy considering demographic variables, income composition and mortality rates. It was found that affect of immunization and human development index was not taken into account in the past. Also, some of the past research was done considering multiple linear regression based on data set of one year for all the countries. Hence, this gives motivation to resolve both the factors stated previously by formulating a regression model based on mixed effects model and multiple linear regression while considering data from a period of 2000 to 2015 for all the countries. Important immunization like Hepatitis B, Polio and Diphtheria will also be considered. In a nutshell, this study will focus on immunization factors, mortality factors, economic factors, social factors and other health related factors as well. Since the observations this dataset are based on different countries, it will be easier for a country to determine the predicting factor which is contributing to lower value of life expectancy. This will help in suggesting a country which area should be given importance in order to efficiently improve the life expectancy of its population.

```{r}
# Reading datafile
Life_Expectancy_Df <- read.csv("../data\ /Life\ Expectancy\ Data.csv", header=TRUE)
Life_Expectancy_Df_2014 <- Life_Expectancy_Df %>% filter(Year == 2014) # Keeping only 2014 data as per requirement
gg_miss_var(Life_Expectancy_Df_2014)

```


#### 1. Does various predicting factors which has been chosen initially really affect the Life expectancy? What are the predicting variables actually affecting the life expectancy?

```{r}



```

#### 2.Should a country having a lower life expectancy value(<65) increase its healthcare expenditure in order to improve its average lifespan?

```{r}


```

#### 3.How does Infant and Adult mortality rates affect life expectancy?

```{r}



```

#### 4.Does Life Expectancy has positive or negative correlation with eating habits, lifestyle, exercise, smoking, drinking alcohol etc.

```{r}



```

#### 5.What is the impact of schooling on the lifespan of humans?

```{r}



```

#### 6.Does Life Expectancy have positive or negative relationship with drinking alcohol?


```{r}


```

#### 7.Do densely populated countries tend to have lower life expectancy?


```{r}



```

#### 8.What is the impact of Immunization coverage on life Expectancy?


```{r}



```



## Objective 1

---

Display the ability to build regression models using the skills and discussions from Unit 1 and 2 with the purpose of identifying key relationships, interpreting those relationships, and making good predictions.  

*Reminder, key here is to tell a good story.*

### Build  Model 1
  - Identify key relationships
  - Ensure interpretability

1. Perform regression analysis
```{r}

```
2. Report predictive ability
    a. Test/train set
    b. CV data
```{r}

```

3. Hypothesis Testing
```{r}

```

4. Interpret the coefficients
```{r}

```

5. Confidence intervals
```{r}

```

6. Practical and statistical significance
```{r}

```

### Model 2

    - Product the best predictions as possible
    - Interpretation is no longer required, hence complexity is no longer an issue

1. Feature selection to avoid overfitting

```{r}

```

2. Create the model

```{r}

```

3. Compare model 1 vs. model 2

```{r}

```

4. Comment on the differences of the models and whether model 2 brings any benefit




## Objective 2

---

    - Nonparametric technique
    - kNN or regression trees (select one)

Set of predictors from previous regression: (fill this out)

1.  Model
```{r}

```

2.	A brief description of your nonparametric modelâ€™s strategy to make a prediction.  Include Pros and Cons.
```{r}

```
3.	Provide any additional details that you feel might be necessary to report.
```{r}

```
4.	Report the test ASE using this nonparametric model so we can see how well it does compared to regression.
```{r}

```

# EDA

## Suchi's EDA

---

```{r}

##############

#1. Does various predicting factors which has been chosen initially really affect the Life expectancy? What are the predicting variables actually affecting the life expectancy?

  #Ploting the available explnatory variables to check co-relation with life expectancy
      ggplot(Life_Expectancy_Df_2014, aes(x = Status , y = Life.expectancy )) +  geom_boxplot()  + xlab("Country's Status ") + ylab("Life Expectancy in Age") +  ggtitle("Distribution of Life Expectancy for Developing vs Developed country")
      ggplot(Life_Expectancy_Df_2014, aes(x = Adult.Mortality, y = Life.expectancy )) +  geom_point()  + xlab("Adult Mortality") + ylab("Life Expectancy in Age")+  ggtitle("Relation between Life Expectancy vs Adult Mortality")
      ggplot(Life_Expectancy_Df_2014, aes(x = infant.deaths, y = Life.expectancy )) +  geom_point()  + xlab("Number of Infant Deaths per 1000 population") + ylab("Life Expectancy in Age")+  ggtitle("Relation between Life Expectancy vs Infant Deaths")
      ggplot(Life_Expectancy_Df_2014, aes(x = Alcohol, y = Life.expectancy )) +  geom_point()  + xlab("Alcohol Consumption") + ylab("Life Expectancy in Age")+  ggtitle("Relation between Life Expectancy vs Alcohol Consumption")
      ggplot(Life_Expectancy_Df_2014, aes(x = percentage.expenditure, y = Life.expectancy )) +  geom_point()  + xlab("Expenditure on health as a percentage of GDP per capita(%)") + ylab("Life Expectancy in Age")+  ggtitle("Relation between Life Expectancy vs Percentage expenditure")
      ggplot(Life_Expectancy_Df_2014, aes(x = Hepatitis.B, y = Life.expectancy )) +  geom_point()  + xlab("Hepatitis B immunization coverage among 1-year-olds (%)") + ylab("Life Expectancy in Age")+  ggtitle("Relation between Life Expectancy vs Hepatitis B immunization")
      ggplot(Life_Expectancy_Df_2014, aes(x = Measles , y = Life.expectancy )) +  geom_point()  + xlab("Number of reported Measles cases per 1000 population") + ylab("Life Expectancy in Age")+  ggtitle("Relation between Life Expectancy vs Measles cases")
      ggplot(Life_Expectancy_Df_2014, aes(x = BMI , y = Life.expectancy )) +  geom_point()  + xlab("BMI") + ylab("Life Expectancy in Age")+  ggtitle("Relation between Life Expectancy vs BMI")
      ggplot(Life_Expectancy_Df_2014, aes(x = under.five.deaths , y = Life.expectancy )) +  geom_point()  + xlab("Number of under-five deaths per 1000 population") + ylab("Life Expectancy in Age")+  ggtitle("Relation between Life Expectancy vs Under Five deaths")
      ggplot(Life_Expectancy_Df_2014, aes(x = Polio, y = Life.expectancy )) +  geom_point()  + xlab("Polio immunization coverage among 1-year-olds (%)") + ylab("Life Expectancy in Age")+  ggtitle("Relation between Life Expectancy vs Polio immunization")
      ggplot(Life_Expectancy_Df_2014, aes(x = Total.expenditure, y = Life.expectancy )) +  geom_point()  + xlab("General Govt expenditure on health as a percentage of total government expenditure") + ylab("Life Expectancy in Age")+  ggtitle("Relation between Life Expectancy vs Total Expenditure")
      ggplot(Life_Expectancy_Df_2014, aes(x = Diphtheria , y = Life.expectancy )) +  geom_point()  + xlab("Diphtheria tetanus toxoid and pertussis (DTP3) immunization coverage among 1-year-olds (%)") + ylab("Life Expectancy in Age")+  ggtitle("Relation between Life Expectancy vs Diphtheria immunization")
      ggplot(Life_Expectancy_Df_2014, aes(x = HIV.AIDS , y = Life.expectancy )) +  geom_point()  + xlab("Deaths per 1000 live births HIV/AIDS (0-4 years)") + ylab("Life Expectancy in Age")+  ggtitle("Relation between Life Expectancy vs HIV deaths")
      ggplot(Life_Expectancy_Df_2014, aes(x = GDP , y = Life.expectancy )) +  geom_point()  + xlab("Gross Domestic Product per capita (in USD)") + ylab("Life Expectancy in Age")+  ggtitle("Relation between Life Expectancy vs GDP")
      ggplot(Life_Expectancy_Df_2014, aes(x = Population , y = Life.expectancy )) +  geom_point()  + xlab("Population of the country") + ylab("Life Expectancy in Age")+  ggtitle("Relation between Life Expectancy vs Population")
      ggplot(Life_Expectancy_Df_2014, aes(x = thinness..1.19.years , y = Life.expectancy )) +  geom_point()  + xlab("Prevalence of thinness among children and adolescents for Age 10-19(%)") + ylab("Life Expectancy in Age")+  ggtitle("Relation between Life Expectancy vs Prevalence of thinness(Age: 10-19)")
      ggplot(Life_Expectancy_Df_2014, aes(x = thinness.5.9.years , y = Life.expectancy )) +  geom_point()  + xlab("Prevalence of thinness among children for Age 5-9(%)") + ylab("Life Expectancy in Age")+  ggtitle("Relation between Life Expectancy vs Prevalence of thinness(Age: 5-9)")
      ggplot(Life_Expectancy_Df_2014, aes(x = Income.composition.of.resources , y = Life.expectancy )) +  geom_point()  + xlab("Human Development Index in terms of income composition of resources") + ylab("Life Expectancy in Age")+  ggtitle("Relation between Life Expectancy vs Income composition)")
      ggplot(Life_Expectancy_Df_2014, aes(x = Schooling , y = Life.expectancy )) +  geom_point()  + xlab("Number of years of Schooling") + ylab("Life Expectancy in Age")+  ggtitle("Relation between Life Expectancy vs Schooling")



##############

#2.Should a country having a lower life expectancy value(<65) increase its healthcare expenditure in order to improve its average lifespan?
#We need to divide the data into 2 categories like >65 and <65 to compare if total expenditure or percentage expenditure has significant impact on life expectancy.

      Life_Expectancy_Df_2014 <- add_column(Life_Expectancy_Df_2014,  Life.expectancy = "Low", .after = "Schooling")
      Life_Expectancy_Df_2014 <- Life_Expectancy_Df_2014 %>% mutate(Life.expectancy.1 = replace(Life.expectancy.1, Life.expectancy >= 65.0, "High"))

      ggplot(Life_Expectancy_Df_2014, aes(x = Life.expectancy.1 , y = Total.expenditure )) +  geom_boxplot()  + xlab("Life Expectancy (More than 65 vs Less than 65) ") + ylab("Govt expenditure on health as a % of total govt expenditure") + ggtitle("Distribution of Healthcare expenditure for low vs high life expectancy") 
      
      ggplot(Life_Expectancy_Df_2014, aes(x = Life.expectancy.1 , y = percentage.expenditure )) +  geom_boxplot()  + xlab("Life Expectancy (More than 65 vs Less than 65) ") + ylab("Expenditure on health as a % of GDP per capita") +  ggtitle("Distribution of Healthcare expenditure for low vs high life expectancy") 


      data_Total.expenditure <- group_by(Life_Expectancy_Df_2014, Life.expectancy.1) %>%
        summarise(
          count = n(),
          mean = mean(Total.expenditure, na.rm = TRUE),
          sd = sd(Total.expenditure, na.rm = TRUE)
        )
      
      summary(data_Total.expenditure)
      
      data_percentage.expenditure <- group_by(Life_Expectancy_Df_2014, Life.expectancy.1) %>%
        summarise(
          count = n(),
          mean = mean(percentage.expenditure, na.rm = TRUE),
          sd = sd(percentage.expenditure, na.rm = TRUE)
        )
      
      summary(data_percentage.expenditure)

 ggqqplot(Life_Expectancy_Df_2014$percentage.expenditure)
 ggqqplot(Life_Expectancy_Df_2014$Total.expenditure)
   
      
  #Equality of variance test for Total.expenditure and percentage.expenditure
      res.ftest <- var.test(Total.expenditure ~ Life.expectancy.1 , data = Life_Expectancy_Df_2014)
      res.ftest

      res.ftest1 <- var.test(percentage.expenditure ~ Life.expectancy.1 , data = Life_Expectancy_Df_2014)
      res.ftest1
      
  #Two Sample T-test / Welch's T-test to find out if the difference we see in EDA actually make sense.
  
    #Two Sample T-test for Total.expenditure variable as there was no significant evidence of differing standard deviation      
        res.total.expenditure <- t.test(Total.expenditure ~ Life.expectancy.1 , data = Life_Expectancy_Df_2014, var.equal = TRUE)
        res.total.expenditure
        
    #Welch's T-test for percentage.expenditure variable as there was significant evidence of differing standard deviation      
        welch.test(percentage.expenditure ~ Life.expectancy.1, Life_Expectancy_Df_2014, rate = 0, alpha = 0.05, na.rm = TRUE, verbose = TRUE)
  

#However I have question on the data. If the definition of percentage expenditure is Expenditure on health as a percentage of Gross Domestic Product per capita(%), then how come it is so high (More than 100%). I do not have domain knowledge. Data suggests that it has impact but is the data accurate? 
      
      
#So I will filter all records where percentage is more than 100 and will fit the model again.
        Life_Expectancy_Df_2014_percentage.expenditure <- Life_Expectancy_Df_2014 %>% filter(percentage.expenditure <  100)  

        data_percentage.expenditure1 <- group_by(Life_Expectancy_Df_2014_percentage.expenditure, Life.expectancy.1) %>%
          summarise(
            count = n(),
            mean = mean(percentage.expenditure, na.rm = TRUE),
            sd = sd(percentage.expenditure, na.rm = TRUE)
          )

        summary(data_percentage.expenditure1)

  # Normality check
        ggqqplot(Life_Expectancy_Df_2014_percentage.expenditure$Total.expenditure) 
      
  # Equality of variance check
        res.ftest2 <- var.test(Total.expenditure ~ Life.expectancy.1 , data = Life_Expectancy_Df_2014_percentage.expenditure) 
        res.ftest2
   
        #Two Sample T-test for Total.expenditure variable(after removing data where percentage value is more than 100) as there was no significant evidence of differing standard deviation      

        res.percentage.expenditure <- t.test(percentage.expenditure ~ Life.expectancy.1, data = Life_Expectancy_Df_2014_percentage.expenditure, var.equal = TRUE)
        res.percentage.expenditure

# We did not get statistically signifcant result. So, this is not related.      
      
        
        
     



##############

#3.How does Infant and Adult mortality rates affect life expectancy?


  #From EDA we can see that infant.deaths is not related to Life.expectancy. Hence fitting the model on Adult.Mortality rate.
      my.model.Adult.Mortality<-lm (Life.expectancy~Adult.Mortality , data = Life_Expectancy_Df_2014 )
      summary(my.model.Adult.Mortality)
      par(mfrow=c(1,2))
      plot(my.model.Adult.Mortality$fitted.values,my.model.Adult.Mortality$residuals,xlab="Fitted Values",ylab="Residuals")
      qqnorm(my.model.Adult.Mortality$residuals)
      qqline(my.model.Adult.Mortality$residuals)

#And from the linear regression model, we can see that Adult mortality rate is negatively related to life expectancy.

##############

#4.Does Life Expectancy has positive or negative correlation with eating habits, lifestyle, exercise, smoking, drinking alcohol etc.


  #We assume that BMI rate is related to lifestyle, eating habits, exercise. Since we see a positive co-relation of BMI with Life Expectancy, we assume that with good eating habits, ample exercice and healthy lifestyle life expectancy would be more.

      my.model.BMI<-lm (Life.expectancy~BMI , data = Life_Expectancy_Df_2014 )
      summary(my.model.BMI)
      par(mfrow=c(1,2))
      plot(my.model.BMI$fitted.values,my.model.BMI$residuals,xlab="Fitted Values",ylab="Residuals")
      qqnorm(my.model.BMI$residuals)
      qqline(my.model.BMI$residuals)


  # Alcohol seems to have positive corelation with life expectancy with a slope of 1.0732.
      my.model.Alcohol<-lm (Life.expectancy~Alcohol , data = Life_Expectancy_Df_2014 )
      summary(my.model.Alcohol)
      par(mfrow=c(1,2))
      plot(my.model.Alcohol$fitted.values,my.model.Alcohol$residuals,xlab="Fitted Values",ylab="Residuals")
      qqnorm(my.model.Alcohol$residuals)
      qqline(my.model.Alcohol$residuals)


##############

```


## Jamie's EDA

---

Linear correlations: 
- Schooling vs Income.composition.of.resource
- thinness..1.19.years vs thinness.5.9.years
- life exp. vs schooling
- life exp. vs income
- infant death vs under 5 death

removed variables that were correlated


```{r}
# print out summary for data
  summary (Life_Expectancy_Df_2014)

# matrix grid to determine correlated variables
  colnames(Life_Expectancy_Df_2014)
  pairs(Life_Expectancy_Df_2014[,c(4:9)])
  pairs(Life_Expectancy_Df_2014[,10:15])
  pairs(Life_Expectancy_Df_2014[,16:22])

# narrowed matrix without correlated variables
  ggpairs(Life_Expectancy_Df_2014[,c(4:5, 7:19, 22)],
        main = "WHO Data",
        pch = 10,
        aes(colour=Life_Expectancy_Df_2014$Status))
```

#### Regression Testing/Variables Reduction

---

Forward, backward, and stepwise regressions were run and all 3 resulted with the same 4 significant variables.

Variables
- Adult.Mortality  
- Total.expenditure
- HIV.AIDS 
- Income.composition.of.resources


```{r}
# regression selections
  
  # ETL
    # dummy code (developing = 1, developed = 0)
      values <- c(0, 1)
      Life_Expectancy_Df_2014$Status_dc <- values[Life_Expectancy_Df_2014$Status]
      Life_Expectancy_Df_2014_dc <- Life_Expectancy_Df_2014[,c(4:23)]
    # remove nulls
      df1_complete <- na.omit(Life_Expectancy_Df_2014_dc) 
      
  # Fit the full model 
    full.model <- lm(Life.expectancy ~., data = df1_complete)
    # Stepwise regression model
      step.model <- stepAIC(full.model, direction = "both", 
                        trace = FALSE)
      summary(step.model)
    # forward regression model
      foward.model <- stepAIC(full.model, direction = "forward", 
                        trace = FALSE)
      summary(foward.model)
    # backward regression model
      backward.model <- stepAIC(full.model, direction = "backward", 
                        trace = FALSE)
      summary(backward.model)
    
    
```



